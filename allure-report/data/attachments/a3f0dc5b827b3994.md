# Test info

- Name: Test Case 24: Download Invoice After Purchase Order >> Download Invoice after purchase and delete account
- Location: /Users/asifuae1983/Desktop/AUTOMATION/PLAYWRIGHT/JulesNewPlayWrightProject/PlayWrightTypeScriptProject/tests/downloadInvoiceAfterPurchase.spec.ts:73:9

# Error details

```
Error: expect(received).resolves.toBeTruthy()

Received: false
    at /Users/asifuae1983/Desktop/AUTOMATION/PLAYWRIGHT/JulesNewPlayWrightProject/PlayWrightTypeScriptProject/tests/downloadInvoiceAfterPurchase.spec.ts:112:67
```

# Page snapshot

```yaml
- banner:
  - link "Automation Exercise website":
    - /url: /
    - img "Automation Exercise website"
  - list:
    - listitem:
      - link " Home":
        - /url: /
    - listitem:
      - link " Products":
        - /url: /products
    - listitem:
      - link " Cart":
        - /url: /view_cart
    - listitem:
      - link " Logout":
        - /url: /logout
    - listitem:
      - link " Delete Account":
        - /url: /delete_account
    - listitem:
      - link " Test Cases":
        - /url: /test_cases
    - listitem:
      - link " API Testing":
        - /url: /api_list
    - listitem:
      - link " Video Tutorials":
        - /url: https://www.youtube.com/c/AutomationExercise
    - listitem:
      - link " Contact us":
        - /url: /contact_us
    - listitem:  Logged in as Bernadette
- heading "Order Placed!" [level=2]
- paragraph: Congratulations! Your order has been confirmed!
- link "Download Invoice":
  - /url: /download_invoice/500
- link "Continue":
  - /url: /
- contentinfo:
  - heading "Subscription" [level=2]
  - textbox "Your email address"
  - button ""
  - paragraph: Get the most recent updates from our site and be updated your self...
  - paragraph: Copyright © 2021 All rights reserved
```

# Test source

```ts
   12 | import { faker } from '@faker-js/faker';
   13 | import type { PaymentDetails } from 'types/testData'; // Import specific type
   14 |
   15 | // const downloadsDir = path.join(__dirname, '..', 'downloads');
   16 | // if (!fs.existsSync(downloadsDir)) {
   17 | //     fs.mkdirSync(downloadsDir, { recursive: true });
   18 | // }
   19 |
   20 | test.describe('Test Case 24: Download Invoice After Purchase Order', () => {
   21 |     let homePage: HomePage;
   22 |     let signupPage: SignupPage;
   23 |     let loginPage: LoginPage;
   24 |     let productsPage: ProductsPage;
   25 |     let cartPage: CartPage;
   26 |     let checkoutPage: CheckoutPage;
   27 |     let paymentPage: PaymentPage;
   28 |     let userData: SignupUserDetails & { signupName: string }; // Combine for all needed fields
   29 |     let paymentData: PaymentDetails;
   30 |
   31 |     test.beforeEach(async ({ page }: { page: Page }) => {
   32 |         homePage = new HomePage(page);
   33 |         signupPage = new SignupPage(page);
   34 |         loginPage = new LoginPage(page);
   35 |         productsPage = new ProductsPage(page);
   36 |         cartPage = new CartPage(page);
   37 |         checkoutPage = new CheckoutPage(page);
   38 |         paymentPage = new PaymentPage(page);
   39 |
   40 |         const rawFirstName = faker.person.firstName();
   41 |         userData = {
   42 |             title: faker.helpers.arrayElement(['Mr', 'Mrs'] as const),
   43 |             name: rawFirstName, // Used for initial signup name field
   44 |             signupName: rawFirstName, // Explicitly for clarity where 'name' for signup is used
   45 |             email: faker.internet.email(),
   46 |             password: faker.internet.password({ length: 10, prefix: 'Test!' }),
   47 |             dayOfBirth: faker.number.int({ min: 1, max: 28 }).toString(),
   48 |             monthOfBirth: faker.date.month(),
   49 |             yearOfBirth: faker.number.int({ min: 1970, max: 2005 }).toString(),
   50 |             firstName: rawFirstName, // Actual first name for address
   51 |             lastName: faker.person.lastName(),
   52 |             company: faker.company.name(),
   53 |             address1: faker.location.streetAddress(),
   54 |             address2: faker.location.secondaryAddress(),
   55 |             country: 'United States',
   56 |             state: faker.location.state(),
   57 |             city: faker.location.city(),
   58 |             zipcode: faker.location.zipCode(),
   59 |             mobileNumber: faker.phone.number(),
   60 |             newsletter: true, // Example
   61 |             optin: true       // Example
   62 |         };
   63 |
   64 |         paymentData = {
   65 |             nameOnCard: `${userData.firstName} ${userData.lastName}`,
   66 |             cardNumber: faker.finance.creditCardNumber(),
   67 |             cvc: faker.finance.creditCardCVV(),
   68 |             expiryMonth: faker.number.int({ min: 1, max: 12 }).toString().padStart(2, '0'),
   69 |             expiryYear: (new Date().getFullYear() + faker.number.int({ min: 1, max: 5 })).toString()
   70 |         };
   71 |     });
   72 |
   73 |     test('Download Invoice after purchase and delete account', async ({ page }: { page: Page }) => {
   74 |         await homePage.goto();
   75 |
   76 |         await homePage.clickSignupLoginLink();
   77 |         await loginPage.enterSignupName(userData.signupName);
   78 |         await loginPage.enterSignupEmail(userData.email);
   79 |         await loginPage.clickSignupButton();
   80 |
   81 |         // fillAccountDetails expects password, ensure it's passed if interface requires it
   82 |         await signupPage.fillAccountDetails(userData);
   83 |         await signupPage.clickCreateAccountButton();
   84 |         await expect(signupPage.isAccountCreatedVisible()).resolves.toBeTruthy();
   85 |         await signupPage.clickContinueButton();
   86 |
   87 |         await expect(homePage.isLoggedInAsVisible(userData.signupName)).resolves.toBeTruthy();
   88 |
   89 |         await homePage.clickProductsLink();
   90 |         await productsPage.addProductToCartByName('Blue Top');
   91 |         await productsPage.clickContinueShopping();
   92 |
   93 |         await homePage.clickCartLink();
   94 |         await expect(cartPage.isShoppingCartVisible()).resolves.toBeTruthy();
   95 |         await cartPage.clickProceedToCheckout();
   96 |
   97 |         await expect(checkoutPage.isAddressDetailsVisible()).resolves.toBeTruthy();
   98 |         await expect(checkoutPage.isReviewYourOrderVisible()).resolves.toBeTruthy();
   99 |
  100 |         const orderComment = "Order for test case 24 - invoice download.";
  101 |         await checkoutPage.enterComment(orderComment);
  102 |         await checkoutPage.clickPlaceOrder();
  103 |
  104 |         await expect(paymentPage.isPaymentPageVisible()).resolves.toBeTruthy();
  105 |         await paymentPage.fillPaymentDetails(
  106 |             paymentData.nameOnCard, paymentData.cardNumber, paymentData.cvc,
  107 |             paymentData.expiryMonth, paymentData.expiryYear
  108 |         );
  109 |
  110 |         await paymentPage.clickPayAndConfirmOrder();
  111 |
> 112 |         await expect(paymentPage.isOrderPlacedVisible()).resolves.toBeTruthy();
      |                                                                   ^ Error: expect(received).resolves.toBeTruthy()
  113 |         const successText = await paymentPage.getOrderSuccessMessage();
  114 |         expect(successText).toContain('Your order has been placed successfully!');
  115 |
  116 |         const results = await Promise.all([
  117 |             page.waitForEvent('download', {timeout: 10000}),
  118 |             paymentPage.clickDownloadInvoice()
  119 |         ]);
  120 |         const download: Download = results[0];
  121 |
  122 |         expect(download.suggestedFilename()).toBe('invoice.txt');
  123 |         // const filePath = path.join(downloadsDir, download.suggestedFilename());
  124 |         // await download.saveAs(filePath);
  125 |         // expect(fs.existsSync(filePath)).toBe(true);
  126 |
  127 |         await paymentPage.clickContinueButton();
  128 |         await expect(page).toHaveURL(/.*\/$/);
  129 |
  130 |         await homePage.clickDeleteAccountLink();
  131 |         await expect(homePage.isAccountDeletedVisible()).resolves.toBeTruthy();
  132 |         await homePage.clickDeleteContinueButton();
  133 |         await expect(homePage.isLoggedInAsVisible(userData.signupName)).resolves.toBeFalsy();
  134 |     });
  135 | });
  136 |
```