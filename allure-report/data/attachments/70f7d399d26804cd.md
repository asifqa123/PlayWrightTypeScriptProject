# Test info

- Name: Test Case 16: Place Order: Login before Checkout >> should login, add product, complete order, and delete account
- Location: /Users/asifuae1983/Desktop/AUTOMATION/PLAYWRIGHT/JulesNewPlayWrightProject/PlayWrightTypeScriptProject/tests/placeOrderLoginBeforeCheckout.spec.ts:99:9

# Error details

```
Error: expect(received).toContain(expected) // indexOf

Expected substring: "loginuser"
Received string:    "."
    at /Users/asifuae1983/Desktop/AUTOMATION/PLAYWRIGHT/JulesNewPlayWrightProject/PlayWrightTypeScriptProject/tests/placeOrderLoginBeforeCheckout.spec.ts:137:57
```

# Page snapshot

```yaml
- banner:
  - link "Website for automation practice":
    - /url: /
    - img "Website for automation practice"
  - list:
    - listitem:
      - link " Home":
        - /url: /
    - listitem:
      - link " Products":
        - /url: /products
    - listitem:
      - link " Cart":
        - /url: /view_cart
    - listitem:
      - link " Logout":
        - /url: /logout
    - listitem:
      - link " Delete Account":
        - /url: /delete_account
    - listitem:
      - link " Test Cases":
        - /url: /test_cases
    - listitem:
      - link " API Testing":
        - /url: /api_list
    - listitem:
      - link " Video Tutorials":
        - /url: https://www.youtube.com/c/AutomationExercise
    - listitem:
      - link " Contact us":
        - /url: /contact_us
    - listitem:  Logged in as LoginBeforeCO9df8d1ae
- list:
  - listitem:
    - link "Home":
      - /url: /
  - listitem: Checkout
- heading "Address Details" [level=2]
- list:
  - listitem:
    - heading "Your delivery address" [level=3]
  - listitem: . LoginBeforeCO9df8d1ae PreCheckout
  - listitem: Existing LLC
  - listitem: 200 Existing Rd
  - listitem
  - listitem: New York City New York 10001
  - listitem: United States
  - listitem: "2125550201"
- list:
  - listitem:
    - heading "Your billing address" [level=3]
  - listitem: . LoginBeforeCO9df8d1ae PreCheckout
  - listitem: Existing LLC
  - listitem: 200 Existing Rd
  - listitem
  - listitem: New York City New York 10001
  - listitem: United States
  - listitem: "2125550201"
- heading "Review Your Order" [level=2]
- table:
  - rowgroup:
    - row "Item Description Price Quantity Total":
      - cell "Item"
      - cell "Description"
      - cell "Price"
      - cell "Quantity"
      - cell "Total"
      - cell
  - rowgroup:
    - row "Product Image Blue Top Women > Tops Rs. 500 1 Rs. 500":
      - cell "Product Image":
        - link "Product Image":
          - /url: ""
          - img "Product Image"
      - cell "Blue Top Women > Tops":
        - heading "Blue Top" [level=4]:
          - link "Blue Top":
            - /url: /product_details/1
        - paragraph: Women > Tops
      - cell "Rs. 500":
        - paragraph: Rs. 500
      - cell "1":
        - button "1"
      - cell "Rs. 500":
        - paragraph: Rs. 500
    - row "Total Amount Rs. 500":
      - cell
      - cell
      - cell "Total Amount":
        - heading "Total Amount" [level=4]
      - cell "Rs. 500":
        - paragraph: Rs. 500
- text: If you would like to add a comment about your order, please write it in the field below.
- textbox
- link "Place Order":
  - /url: /payment
- insertion:
  - iframe
- contentinfo:
  - heading "Subscription" [level=2]
  - textbox "Your email address"
  - button ""
  - paragraph: Get the most recent updates from our site and be updated your self...
  - paragraph: Copyright © 2021 All rights reserved
```

# Test source

```ts
   37 |         const tempHomePage = new HomePage(page);
   38 |         const tempLoginPage = new LoginPage(page);
   39 |         const tempSignupPage = new SignupPage(page);
   40 |
   41 |         await tempHomePage.goto();
   42 |         await tempHomePage.clickSignupLoginLink();
   43 |         await tempLoginPage.signup(userName, userEmail);
   44 |
   45 |         const accountInfo: AccountInformation = {
   46 |             title: loadedExistingUserData.title || 'Mr',
   47 |             password: userPassword,
   48 |             dayOfBirth: loadedExistingUserData.dobDay || '1',
   49 |             monthOfBirth: loadedExistingUserData.dobMonth || 'January',
   50 |             yearOfBirth: loadedExistingUserData.dobYear || '1990',
   51 |             newsletter: loadedExistingUserData.newsletter || false,
   52 |             optin: loadedExistingUserData.optin || false,
   53 |         };
   54 |         const addressInfo: AddressInformation = {
   55 |             firstName: userName, // Or loadedExistingUserData.firstName
   56 |             lastName: loadedExistingUserData.lastName || 'TestUser',
   57 |             company: loadedExistingUserData.company || 'Test Corp',
   58 |             address1: loadedExistingUserData.address1 || '123 Test St',
   59 |             address2: loadedExistingUserData.address2 || '',
   60 |             country: loadedExistingUserData.country || 'United States',
   61 |             state: loadedExistingUserData.state || 'California',
   62 |             city: loadedExistingUserData.city || 'TestCity',
   63 |             zipcode: loadedExistingUserData.zipcode || '12345',
   64 |             mobileNumber: loadedExistingUserData.mobileNumber || '5551234567'
   65 |         };
   66 |         await tempSignupPage.fillAccountInformationPart(accountInfo);
   67 |         await tempSignupPage.fillAddressInformationPart(addressInfo);
   68 |         await tempSignupPage.clickCreateAccountButton();
   69 |         await expect(tempSignupPage.accountCreatedText).toBeVisible();
   70 |         await tempSignupPage.clickContinueButton();
   71 |
   72 |         const adSelector = '#ad_position_box';
   73 |         if (await page.locator(adSelector).isVisible({ timeout: 5000 })) {
   74 |             await page.evaluate(sel => document.querySelector(sel)?.remove(), adSelector);
   75 |         }
   76 |         try {
   77 |             await tempHomePage.clickLogoutLink(); // Use Page Object method
   78 |         } catch (e) {
   79 |             await page.reload({ waitUntil: 'domcontentloaded' });
   80 |             if (await page.locator(adSelector).isVisible({ timeout: 5000 })) {
   81 |                  await page.evaluate(sel => document.querySelector(sel)?.remove(), adSelector);
   82 |             }
   83 |             await tempHomePage.clickLogoutLink();
   84 |         }
   85 |         await expect(page).toHaveURL(/.*login/);
   86 |         await page.close();
   87 |     });
   88 |
   89 |     test.beforeEach(async ({ page }: { page: Page }) => {
   90 |         homePage = new HomePage(page);
   91 |         loginPage = new LoginPage(page);
   92 |         productsPage = new ProductsPage(page);
   93 |         cartPage = new CartPage(page);
   94 |         checkoutPage = new CheckoutPage(page);
   95 |         paymentPage = new PaymentPage(page);
   96 |         await homePage.goto();
   97 |     });
   98 |
   99 |     test('should login, add product, complete order, and delete account', async ({ page }: { page: Page }) => {
  100 |         await homePage.clickSignupLoginLink();
  101 |         await expect(loginPage.loginToYourAccountText).toBeVisible();
  102 |         await loginPage.login(userEmail, userPassword);
  103 |
  104 |         const adSelector = '#ad_position_box';
  105 |         if (await page.locator(adSelector).isVisible({ timeout: 5000 })) {
  106 |             await page.evaluate(sel => document.querySelector(sel)?.remove(), adSelector);
  107 |         }
  108 |         const loggedInAsSelector = homePage.loggedInAsTextSelector(userName);
  109 |         try {
  110 |             await page.waitForSelector(loggedInAsSelector, { timeout: 10000 });
  111 |         } catch (e) {
  112 |             await page.reload({ waitUntil: 'domcontentloaded' });
  113 |              if (await page.locator(adSelector).isVisible({ timeout: 5000 })) {
  114 |                 await page.evaluate(sel => document.querySelector(sel)?.remove(), adSelector);
  115 |             }
  116 |             await page.waitForSelector(loggedInAsSelector, { timeout: 15000 });
  117 |         }
  118 |         await expect(page.locator(loggedInAsSelector)).toBeVisible();
  119 |
  120 |         if (!productToOrder || !productToOrder.name) {
  121 |             throw new Error("Product to order or its name is undefined.");
  122 |         }
  123 |         await homePage.clickProductsLink(); // Or navigate directly if URL is fixed
  124 |         await productsPage.addProductToCartByName(productToOrder.name);
  125 |         await productsPage.clickContinueShopping();
  126 |
  127 |         await homePage.clickCartLink();
  128 |         await expect(page).toHaveURL(/.*view_cart/);
  129 |         await expect(cartPage.shoppingCartText).toBeVisible();
  130 |
  131 |         await cartPage.clickProceedToCheckout();
  132 |         await expect(checkoutPage.addressDetailsText).toBeVisible();
  133 |         await expect(checkoutPage.reviewYourOrderText).toBeVisible();
  134 |
  135 |         // Basic check for address, more detailed in TC23
  136 |         const deliveryDetails = await checkoutPage.getDeliveryAddressDetails();
> 137 |         expect(deliveryDetails.firstName.toLowerCase()).toContain((loadedExistingUserData.firstName || userName).toLowerCase());
      |                                                         ^ Error: expect(received).toContain(expected) // indexOf
  138 |
  139 |
  140 |         await checkoutPage.enterComment("Order placed by existing user - Login before checkout.");
  141 |         await checkoutPage.clickPlaceOrder();
  142 |
  143 |         await paymentPage.fillPaymentDetails(
  144 |             paymentDetails.nameOnCard, paymentDetails.cardNumber, paymentDetails.cvc,
  145 |             paymentDetails.expiryMonth, paymentDetails.expiryYear
  146 |         );
  147 |         await paymentPage.clickPayAndConfirmOrder();
  148 |         await expect(paymentPage.orderPlacedText).toBeVisible({ timeout: 15000 });
  149 |
  150 |         await homePage.goto(); // Go home to find delete link
  151 |          if (await page.locator(adSelector).isVisible({ timeout: 5000 })) {
  152 |             await page.evaluate(sel => document.querySelector(sel)?.remove(), adSelector);
  153 |         }
  154 |         await homePage.clickDeleteAccountLink();
  155 |         await expect(homePage.accountDeletedText).toBeVisible({ timeout: 10000 });
  156 |         await homePage.clickDeleteContinueButton();
  157 |         await expect(page).toHaveURL('https://automationexercise.com/');
  158 |     });
  159 | });
  160 |
```